 
package org.jmedikit.plugin.gui;

import java.util.ArrayList;

import javax.annotation.PostConstruct;
import javax.inject.Inject;

import org.eclipse.e4.core.di.annotations.Optional;
import org.eclipse.e4.ui.di.UIEventTopic;
import org.eclipse.jface.viewers.ArrayContentProvider;
import org.eclipse.jface.viewers.CellLabelProvider;
import org.eclipse.jface.viewers.ColumnLabelProvider;
import org.eclipse.jface.viewers.TableViewer;
import org.eclipse.jface.viewers.TableViewerColumn;
import org.eclipse.jface.viewers.ViewerCell;
import org.eclipse.swt.SWT;
import org.eclipse.swt.layout.GridData;
import org.eclipse.swt.layout.GridLayout;
import org.eclipse.swt.widgets.Composite;
import org.eclipse.swt.widgets.List;
import org.eclipse.swt.widgets.Table;
import org.jmedikit.plugin.gui.events.EventConstants;

public class DicomTagView {
	
	private List list;
	
	private TableViewer viewer;
	
	private Table table;
	
	@Inject
	public DicomTagView() {

	}
	
	@PostConstruct
	public void createGui(Composite parent){
		Composite container = new Composite(parent, SWT.NONE);
		container.setLayout(new GridLayout(2, false));
		container.setLayoutData(new GridData(GridData.FILL_BOTH));
		
		//list = new List(container, SWT.MULTI | SWT.V_SCROLL | SWT.H_SCROLL);
		//list.setLayoutData(new GridData(GridData.FILL_BOTH));
		
		viewer = new TableViewer(container, SWT.MULTI | SWT.H_SCROLL | SWT.V_SCROLL | SWT.FULL_SELECTION | SWT.BORDER);
		
		createColumns();
		
		table = viewer.getTable();
		table.setHeaderVisible(true);
		table.setLinesVisible(true); 
		table.setLayoutData(new GridData(GridData.FILL_BOTH));
		viewer.setContentProvider(ArrayContentProvider.getInstance());
	}
	
	@Inject
	@Optional
	public void getNotifiedDicomTreeSelection(@UIEventTopic(EventConstants.DICOM_TAGS_CHANGED) ArrayList<String[]> tags){
		//list.removeAll();
		table.removeAll();
		viewer.setInput(tags);
	}

	private void createColumns(){
		TableViewerColumn colTagname = new TableViewerColumn(viewer, SWT.NONE);
		colTagname.getColumn().setWidth(200);
		colTagname.getColumn().setText("Tagname");
		colTagname.setLabelProvider(new ColumnLabelProvider() {
			@Override
			public String getText(Object element) {
				String[] item = (String[]) element;
				return item[0];
			}
		});
		
		
		TableViewerColumn colTag = new TableViewerColumn(viewer, SWT.NONE);
		colTag.getColumn().setWidth(200);
		colTag.getColumn().setText("Tag");
		colTag.setLabelProvider(new ColumnLabelProvider() {
			@Override
			public String getText(Object element) {
				String[] item = (String[]) element;
				return item[1];
			}
		});
		
		TableViewerColumn colVR = new TableViewerColumn(viewer, SWT.NONE);
		colVR.getColumn().setWidth(200);
		colVR.getColumn().setText("VR");
		colVR.setLabelProvider(new ColumnLabelProvider() {
			@Override
			public String getText(Object element) {
				String[] item = (String[]) element;
				return item[2];
			}
		});
		
		TableViewerColumn colValue = new TableViewerColumn(viewer, SWT.NONE);
		colValue.getColumn().setWidth(400);
		colValue.getColumn().setText("Wert");
		colValue.setLabelProvider(new ColumnLabelProvider() {
			@Override
			public String getText(Object element) {
				String[] item = (String[]) element;
				return item[4];
			}
		});
		
		TableViewerColumn colVM = new TableViewerColumn(viewer, SWT.NONE);
		colVM.getColumn().setWidth(200);
		colVM.getColumn().setText("VM");
		colVM.setLabelProvider(new ColumnLabelProvider() {
			@Override
			public String getText(Object element) {
				String[] item = (String[]) element;
				return item[3];
			}
		});
		
	}
}