package org.jmedikit;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileInputStream;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.io.Reader;
import java.io.StringWriter;
import java.io.Writer;
import java.net.URL;
import java.net.URLClassLoader;
import java.util.ArrayList;
import java.util.Arrays;
import java.util.List;

import javax.tools.DiagnosticCollector;
import javax.tools.DiagnosticListener;
import javax.tools.JavaCompiler;
import javax.tools.JavaFileManager;
import javax.tools.JavaFileObject;
import javax.tools.StandardJavaFileManager;
import javax.tools.ToolProvider;

import org.eclipse.core.runtime.FileLocator;
import org.jmedikit.lib.io.JavaFileFromString;
import org.osgi.framework.BundleActivator;
import org.osgi.framework.BundleContext;

public class Activator implements BundleActivator{

	private static BundleContext context;

	static BundleContext getContext() {
		return context;
	}

	/*
	 * (non-Javadoc)
	 * @see org.osgi.framework.BundleActivator#start(org.osgi.framework.BundleContext)
	 */
	public void start(BundleContext bundleContext) throws Exception {
		Activator.context = bundleContext;
		System.out.println("ORG.JMEDIKIT.PLUGIN STARTUP");
		
		File f = new File("C:\\Users\\rkorb\\Desktop\\plugins\\Testplugin\\src\\JmkPlgn.java");
		System.out.println(f.getAbsolutePath()+", "+f.getPath()+", "+System.getProperty("user.dir"));
		//JavaCompiler compiler = ToolProvider.getSystemJavaCompiler();
		
		ClassLoader classLoader = Activator.class.getClassLoader();

	    try {
	        Class aClass = classLoader.loadClass("C:\\Users\\rkorb\\Desktop\\plugins\\Testplugin\\src\\JmkPlgn");
	        System.out.println("aClass.getName() = " + aClass.getName());
	    } catch (ClassNotFoundException e) {
	        e.printStackTrace();
	    }
	    
	    
		
	   /* File[] javaFiles = new File[]{f};  
	      
	      
	    DiagnosticCollector<JavaFileObject> diagnostics = new DiagnosticCollector<JavaFileObject>();  
	    StandardJavaFileManager fileManager = compiler.getStandardFileManager(diagnostics, null, null);  
	      
	    Iterable<? extends JavaFileObject> compilationUnits = fileManager.getJavaFileObjectsFromFiles(Arrays.asList(javaFiles));  
	      
	    List<String> optionList = new ArrayList<String>();  
	    optionList.addAll(Arrays.asList("-classpath", "C:\\Users\\rkorb\\Desktop\\jmedikit\\jmedikit\\plugins\\org.jmedikit.plugin_1.0.0.201312212324.jar"));  
	    JavaCompiler.CompilationTask task = compiler.getTask(null, fileManager, diagnostics, optionList, null, compilationUnits);  
	    System.out.println(task.call());*/
	    //compiler.run(null, null, null, javaFiles[0].getPath());
	}

	/*
	 * (non-Javadoc)
	 * @see org.osgi.framework.BundleActivator#stop(org.osgi.framework.BundleContext)
	 */
	public void stop(BundleContext bundleContext) throws Exception {
		Activator.context = null;
	}

}
